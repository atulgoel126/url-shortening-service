<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Authenticating...</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <p>Please wait while we sign you in...</p>
    <script th:inline="javascript">
        /*<![CDATA[*/
        const supabaseUrl = /*[[${supabase.url}]]*/ 'default_url';
        const supabaseAnonKey = /*[[${supabase.publishableKey}]]*/ 'default_key';
        
        const { createClient } = supabase;
        const supabaseClient = createClient(supabaseUrl, supabaseAnonKey);

        // The Supabase client library automatically handles the session from the URL fragment.
        // It will store the session in localStorage. We listen for the SIGNED_IN event
        // to know when this is complete, then we set our required cookie and redirect.
        supabaseClient.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN') {
                if (session) {
                    // Set the access token in a cookie so our backend filter can use it.
                    document.cookie = `sb-access-token=${session.access_token}; path=/; max-age=${60 * 60 * 24 * 7}; samesite=lax`;
                }
                // Redirect to the dashboard to complete the login process.
                window.location.href = '/dashboard';
            }
        });
        /*]]>*/
    </script>
</body>
</html>